{
    "title": "Duplicate Strategy Entries: Same Strategy Creates New DB Records",
    "body": "# Duplicate Strategy Entries\n\n## Issue Description\nThe user observed that executing the **same strategy** (presumably restarting it in Quantower or the trading platform) results in the creation of a **new Strategy entity** in the database, leading to a new `StrategyInstance` and `StrategyRun` chain.\n\n## Expected Behavior\n- If the Strategy definition (Name, ID, Version) hasn't changed, the system should map the new Run to the **existing** Strategy and Instance (unless parameters changed substantially).\n- The `strategy_id` should act as the unique key to prevent duplication.\n\n## Observed Behavior\n- A new row in the `strategies` table is created for every execution session, cluttering the database and fragmenting the history of a single strategy logic.\n\n## Potential Causes\n1. **Dynamic ID Generation**: The client (Quantower exporter) might be generating a random `strategy_id` (Guid) at every startup instead of using a persistent static ID for the strategy class.\n2. **Upsert Logic Failure**: The backend `upsert_strategy` function might be failing to find the existing record (e.g., mismatch in ID format, case sensitivity) and defaulting to creation.\n3. **Instance Separation**: It is normal to have a new `Run`, but `Strategy` and `StrategyInstance` (if params are identical) should ideally be reused.\n\n## Action Items\n1. Check the `StrategyExporter` C# code to ensure `StrategyId` is static/persistent for the algorithm, not random.\n2. Verify `upsert_strategy` in `ingest.py` uses the correct primary key lookup.\n3. Implement a check: if `strategy_id` exists, update timestamp/metadata but do not create new.",
    "labels": [
        "bug",
        "backend",
        "data-integrity",
        "duplication"
    ],
    "assignees": []
}